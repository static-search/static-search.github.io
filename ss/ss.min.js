/*!
 * SS - Static Search v0.0.1
 * https://static-search.github.io/
 *
 * Created by Natan Felles
 * https://natanfelles.github.io
 *
 * Initially based on Tipue Search 6.1
 * http://www.tipue.com/search
 *
 * Released under the MIT license
 *
 * Date: 2017-07-11T10:11Z
 */
(function($){$.fn.ss=function(options){var set=$.extend({contentLocation:"ss/content.json",configLocation:"ss/config.js",lang:"en",cacheSeconds:7200,contextBuffer:60,contextLength:60,contextStart:90,debug:false,descriptiveWords:25,highlightTerms:true,minimumLength:3,newWindow:false,show:10,showContext:true,showRelated:true,showTime:true,showTitleCount:true,showURL:true,wholeWords:true},options);var ss={input:this,pages:[],lang:{},config:{}};return this.each(function(){$.ajax({cache:false});var ss_t_c=0;$("#ss_content").html('<h1 class="text-center text-muted"><i class="glyphicon glyphicon-search"></i></h1>');var time={};time.start=new Date().getTime();time.expires=time.start+1000*set.cacheSeconds;if(!localStorage.getItem("ss.pages")||!localStorage.getItem("ss.lang")||localStorage.getItem("ss.expires")<=time.start){if(set.debug===true){console.log("SS: Getting new data...");}$.when($.getJSON(set.contentLocation).fail(function(){console.log('SS: Content file "'+set.contentLocation+'.json" could not be get.');}),$.getJSON("ss/lang/"+set.lang+".json").fail(function(){console.log('SS: Language file "'+set.lang+'" could not be get.');}),$.getScript(set.configLocation).fail(function(){console.log('SS: Config file "'+set.configLocation+'" could not be get.');})).done(function(p,l,c){if(set.debug===true){console.log("SS: Done.");}localStorage.setItem("ss.expires",time.expires);ss.pages=p[0];localStorage.setItem("ss.pages",JSON.stringify(ss.pages));ss.lang=l[0];localStorage.setItem("ss.lang",JSON.stringify(ss.lang));ss.config=config;localStorage.setItem("ss.config",JSON.stringify(config));exec();});}else{if(set.debug===true){console.log("SS: Getting cached data...");}ss.pages=$.parseJSON(localStorage.getItem("ss.pages"));ss.lang=$.parseJSON(localStorage.getItem("ss.lang"));ss.config=$.parseJSON(localStorage.getItem("ss.config"));if(set.debug===true){console.log("SS: Done.");}exec();}var a_target=set.newWindow?' target="_blank"':"";function getURLP(name){var _locSearch=location.search;var _splitted=(new RegExp("[?|&]"+name+"=([^&;]+?)(&|#|;|$)").exec(_locSearch)||[,""]);var searchString=_splitted[1].replace(/\+/g,"%20");try{searchString=decodeURIComponent(searchString);}catch(e){searchString=unescape(searchString);}return searchString||null;}function getSS(start,replace){var out="";var show_replace=false;var show_stop=false;var standard=true;var c=0;var found=[];var d_o=$(ss.input).val();var d=d_o.toLowerCase();d=$.trim(d);if((d.match('^"')&&d.match('"$'))||(d.match("^'")&&d.match("'$"))){standard=false;}var d_w=d.split(" ");if(standard){d="";for(i=0;i<d_w.length;i++){var a_w=true;for(f=0;f<ss.lang.sw.length;f++){if(d_w[i]===ss.lang.sw[f]){a_w=false;show_stop=true;}}if(a_w){d=d+" "+d_w[i];}}d=$.trim(d);d_w=d.split(" ");}else{d=d.substring(1,d.length-1);}var score,i,f=0;if(d.length>=set.minimumLength){if(standard){if(replace){var d_r=d;for(i=0;i<d_w.length;i++){for(f=0;f<ss.config.replace.words.length;f++){if(d_w[i]===ss.config.replace.words[f].word){d=d.replace(d_w[i],ss.config.replace.words[f].replace_with);show_replace=true;}}}d_w=d.split(" ");}var d_t=d;for(i=0;i<d_w.length;i++){for(f=0;f<ss.config.stem.words.length;f++){if(d_w[i]===ss.config.stem.words[f].word){d_t=d_t+" "+ss.config.stem.words[f].stem;}}}d_w=d_t.split(" ");var s_t="";for(i=0;i<ss.pages.length;i++){score=0;s_t=ss.pages[i].text;for(f=0;f<d_w.length;f++){if(set.wholeWords){var pat=new RegExp("\\b"+d_w[f]+"\\b","gi");}else{var pat=new RegExp(d_w[f],"gi");}if(ss.pages[i].title.search(pat)!=-1){var m_c=ss.pages[i].title.match(pat).length;score+=(20*m_c);}if(ss.pages[i].text.search(pat)!=-1){var m_c=ss.pages[i].text.match(pat).length;score+=(20*m_c);}if(ss.pages[i].tags.search(pat)!=-1){var m_c=ss.pages[i].tags.match(pat).length;score+=(10*m_c);}if(ss.pages[i].url.search(pat)!=-1){score+=20;}if(score!==0){for(var e=0;e<ss.config.weight.weight.length;e++){if(ss.pages[i].url==ss.config.weight.weight[e].url){score+=ss.config.weight.weight[e].score;}}}if(d_w[f].match("^-")){pat=new RegExp(d_w[f].substring(1),"i");if(ss.pages[i].title.search(pat)!=-1||ss.pages[i].text.search(pat)!=-1||ss.pages[i].tags.search(pat)!=-1){score=0;}}}if(score!==0){found.push({score:score,title:ss.pages[i].title,desc:s_t,url:ss.pages[i].url});c++;}}}else{for(i=0;i<ss.pages.length;i++){score=0;s_t=ss.pages[i].text;var pat=new RegExp(d,"gi");if(ss.pages[i].title.search(pat)!=-1){var m_c=ss.pages[i].title.match(pat).length;score+=(20*m_c);}if(ss.pages[i].text.search(pat)!=-1){var m_c=ss.pages[i].text.match(pat).length;score+=(20*m_c);}if(ss.pages[i].tags.search(pat)!=-1){var m_c=ss.pages[i].tags.match(pat).length;score+=(10*m_c);}if(ss.pages[i].url.search(pat)!=-1){score+=20;}if(score!==0){for(var e=0;e<ss.config.weight.weight.length;e++){console.log(ss.pages[i].url);console.log(ss.config.weight.weight[e].url);if(ss.pages[i].url==ss.config.weight.weight[e].url){score+=ss.config.weight.weight[e].score;}}}if(score!=0){found.push({score:score,title:ss.pages[i].title,desc:s_t,url:ss.pages[i].url});c++;}}}if(c!=0){if(set.showTitleCount&&ss_t_c==0){var title=document.title;document.title="("+c+") "+title;ss_t_c++;}if(show_replace){out+='<div class="alert alert-info">'+ss.lang[1]+" <em>"+d+"</em>. "+ss.lang[2]+' <a id="ss.config.replaced" class="alert-link">'+d_r+"</a></div>";}if(c==1){out+='<div class="text-muted text-right">'+ss.lang[3];}else{var c_c=c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");out+='<div class="text-muted text-right">'+c_c+" "+ss.lang[4];}if(set.showTime){time.end=new Date().getTime();time.diff=(time.end-time.start)/1000;out+=" ("+time.diff.toFixed(2)+" "+ss.lang[13]+")";set.showTime=false;}out+="</div>";found.sort(function(a,b){return b.score-a.score;});out+='<div class="list-group">';var l_o=0;for(i=0;i<found.length;i++){if(l_o>=start&&l_o<set.show+start){out+='<a href="'+found[i].url+'" class="list-group-item"'+a_target+'><h4 class="list-group-item-heading">'+found[i].title+"</h4>";if(set.debug){out+='<span class="text-danger">'+ss.lang[15]+": "+found[i].score+"</span>";}if(set.showURL){var s_u=found[i].url.toLowerCase();if(s_u.indexOf("http://")===0){s_u=s_u.slice(7);}out+='<div class="text-muted">'+s_u+"</div>";}if(found[i].desc){var t=found[i].desc;if(set.showContext){d_w=d.split(" ");var s_1=found[i].desc.toLowerCase().indexOf(d_w[0]);if(s_1>set.contextStart){var t_1=t.substr(s_1-set.contextBuffer);var s_2=t_1.indexOf(" ");t_1=t.substr(s_1-set.contextBuffer+s_2);t_1=$.trim(t_1);if(t_1.length>set.contextLength){t="... "+t_1;}}}if(standard){d_w=d.split(" ");for(var f=0;f<d_w.length;f++){if(set.highlightTerms){var patr=new RegExp("("+d_w[f]+")","gi");t=t.replace(patr,"<h0011>$1<h0012>");}}}else{if(set.highlightTerms){var patr=new RegExp("("+d+")","gi");t=t.replace(patr,"<strong>$1</strong>");}}var t_d="";var t_w=t.split(" ");if(t_w.length<set.descriptiveWords){t_d=t;}else{for(f=0;f<set.descriptiveWords;f++){t_d+=t_w[f]+" ";}}t_d=$.trim(t_d);if(t_d.charAt(t_d.length-1)!=="."){t_d+=" ...";}t_d=t_d.replace(/h0011/g,"strong");t_d=t_d.replace(/h0012/g,"/strong");out+='<p class="list-group-item-text">'+t_d+"</p></a>";}}l_o++;}out+="</div>";if(set.showRelated&&standard){f=0;for(i=0;i<ss.config.related.searches.length;i++){if(d===ss.config.related.searches[i].search){if(show_replace){d_o=d;}if(!f){out+='<div class="panel panel-default"><div class="panel-heading">'+ss.lang[14]+" <strong>"+d_o+'</strong></div><div class="list-group">';}out+='<a class="ss.config.related list-group-item" data-related="'+ss.config.related.searches[i].related+'">';if(ss.config.related.searches[i].before){out+='<span class="label label-default">'+ss.config.related.searches[i].before+"</span> ";}out+=ss.config.related.searches[i].related;if(ss.config.related.searches[i].after){out+=' <span class="label label-default">'+ss.config.related.searches[i].after+"</span>";}out+="</a>";f++;}}if(f){out+="</div></div>";}}if(c>set.show){var tp=Math.ceil(c/set.show);var cp=(start/set.show);out+='<nav class="text-center"><ul id="ss_pagination" class="pagination">';if(start>0){out+='<li><a accesskey="p" data-start="'+(start-set.show)+'" data-replace="'+replace+'">'+ss.lang[5]+"</a></li>";}if(cp<=2){var p_b=0;p_b=tp;if(tp>3){p_b=3;}for(f=0;f<p_b;f++){if(f==cp){out+='<li class="active"><span>'+(f+1)+"</span></li>";}else{out+='<li><a data-start="'+(f*set.show)+'" data-replace="'+replace+'">'+(f+1)+"</a></li>";}}}else{var p_b=0;p_b=cp+2;if(p_b>tp){p_b=tp;}for(f=cp-1;f<p_b;f++){if(f==cp){out+='<li class="active"><span>'+(f+1)+"</span></li>";}else{out+='<li><a data-start="'+(f*set.show)+'" data-replace="'+replace+'">'+(f+1)+"</a></li>";}}}if(cp+1!==tp){out+='<li><a accesskey="n" data-start="'+(start+set.show)+'" data-replace="'+replace+'">'+ss.lang[6]+"</a></li>";}out+="</ul></nav>";}}else{out+='<div  class="alert alert-danger">'+ss.lang[7]+"</div>";}}else{if(show_stop){out+='<div  class="alert alert-danger">'+ss.lang[7]+" "+ss.lang[8]+"</div>";}else{out+='<div  class="alert alert-danger"><strong>'+ss.lang[9]+"</strong><ul>";if(set.minimumLength===1){out+="<li>"+ss.lang[10]+"</li>";}else{out+="<li>"+ss.lang[11]+" "+set.minimumLength+" "+ss.lang[12]+"</li>";}out+="</ul></div>";}}$("#ss_content").html(out);$("#ss.config.replaced").click(function(){getSS(0,false);});$(".ss.config.related").click(function(){$(ss.input).val($(this).data("related"));getSS(0,true);});$("#ss_pagination").children("li").children("a").click(function(){getSS($(this).data("start"),$(this).data("replace"));});}function exec(){if(set.debug===true){console.log("SS: Object...");console.log(ss);}if(getURLP("ss")){$(ss.input).val(getURLP("ss"));getSS(0,true);}$(this).keyup(function(){if($(ss.input).val().length>=set.minimumLength){getSS(0,true);}});}});};})(jQuery);