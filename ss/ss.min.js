/*!
 * SS - Static Search v1.0.0
 * https://static-search.github.io/
 *
 * Created by Natan Felles
 * https://natanfelles.github.io
 *
 * Initially based on Tipue Search 6.1
 * http://www.tipue.com/search
 *
 * Released under the MIT license
 *
 * Date: 2017-07-18T15:05Z
 */
(function(a){a.fn.ss=function(c){var b="";a("script").each(function(g,f){if(f.src.indexOf("ss.min.js")!==-1){b=f.src.replace("ss.min.js","")}else{if(f.src.indexOf("ss.js")!==-1){b=f.src.replace("ss.js","")}}});var e=a.extend({contentLocation:b+"content.json",configLocation:b+"config.js",lang:"en",contentId:"ss_content",cacheSeconds:7200,debug:false,descriptiveWords:25,highlightTerms:true,minimumLength:3,newWindow:false,show:10,showRelated:true,showTime:true,showTitleCount:true,showURL:true,wholeWords:true},c);var d={input:this,pages:[],lang:{},config:{}};return this.each(function(){a.ajax({cache:false});var h=0;a("#"+e.contentId).html('<h1 class="text-center text-muted"><i class="glyphicon glyphicon-search"></i></h1>');var i={};i.start=new Date().getTime();i.expires=i.start+1000*e.cacheSeconds;if(!localStorage.getItem("ss.pages")||!localStorage.getItem("ss.lang")||!localStorage.getItem("ss.config")||localStorage.getItem("ss.expires")<=i.start){if(e.debug===true){console.log("SS: Getting new data...")}a.when(a.getJSON(e.contentLocation).fail(function(){console.log('SS: Content file "'+e.contentLocation+'" could not be get.')}),a.getJSON(b+"/lang/"+e.lang+".json").fail(function(){console.log('SS: Language file "'+e.lang+'" could not be get.')}),a.getScript(e.configLocation).fail(function(){console.log('SS: Config file "'+e.configLocation+'" could not be get.')})).done(function(n,m,o){if(e.debug===true){console.log("SS: Done.")}localStorage.setItem("ss.expires",i.expires);d.pages=n[0];localStorage.setItem("ss.pages",JSON.stringify(d.pages));d.lang=m[0];localStorage.setItem("ss.lang",JSON.stringify(d.lang));d.config=config;localStorage.setItem("ss.config",JSON.stringify(config));f()})}else{if(e.debug===true){console.log("SS: Getting cached data...")}d.pages=a.parseJSON(localStorage.getItem("ss.pages"));d.lang=a.parseJSON(localStorage.getItem("ss.lang"));d.config=a.parseJSON(localStorage.getItem("ss.config"));if(e.debug===true){console.log("SS: Done.")}f()}var j=e.newWindow?' target="_blank"':"";function g(o){var m=location.search;var l=(new RegExp("[?|&]"+o+"=([^&;]+?)(&|#|;|$)").exec(m)||[,""]);var n=l[1].replace(/\+/g,"%20");try{n=decodeURIComponent(n)}catch(p){n=unescape(n)}return n||null}function k(q,Q){var I="";var F=false;var C=false;var P=true;var O=0;var B=[];var r=a(d.input).val();var M=r.toLowerCase();M=a.trim(M);if((M.match('^"')&&M.match('"$'))||(M.match("^'")&&M.match("'$"))){P=false}var m=M.split(" ");if(P){M="";for(H=0;H<m.length;H++){var y=true;for(K=0;K<d.lang.sw.length;K++){if(m[H]===d.lang.sw[K]){y=false;C=true}}if(y){M=M+" "+m[H]}}M=a.trim(M);m=M.split(" ")}else{M=M.substring(1,M.length-1)}var J,H,K=0;if(M.length>=e.minimumLength){if(P){if(Q){var p=M;for(H=0;H<m.length;H++){for(K=0;K<d.config.replace.words.length;K++){if(m[H]===d.config.replace.words[K].word){M=M.replace(m[H],d.config.replace.words[K].replace_with);F=true}}}m=M.split(" ")}var n=M;for(H=0;H<m.length;H++){for(K=0;K<d.config.stem.words.length;K++){if(m[H]===d.config.stem.words[K].word){n=n+" "+d.config.stem.words[K].stem}}}m=n.split(" ");var z="";for(H=0;H<d.pages.length;H++){J=0;z=d.pages[H].text;for(K=0;K<m.length;K++){if(e.wholeWords){var A=new RegExp("\\b"+m[K]+"\\b","gi")}else{var A=new RegExp(m[K],"gi")}if(d.pages[H].title.search(A)!=-1){var E=d.pages[H].title.match(A).length;J+=(20*E)}if(d.pages[H].text.search(A)!=-1){var E=d.pages[H].text.match(A).length;J+=(20*E)}if(d.pages[H].tags.search(A)!=-1){var E=d.pages[H].tags.match(A).length;J+=(10*E)}if(d.pages[H].url.search(A)!=-1){J+=20}if(J!==0){for(var L=0;L<d.config.weight.weight.length;L++){if(d.pages[H].url==d.config.weight.weight[L].url){J+=d.config.weight.weight[L].score}}}if(m[K].match("^-")){A=new RegExp(m[K].substring(1),"i");if(d.pages[H].title.search(A)!=-1||d.pages[H].text.search(A)!=-1||d.pages[H].tags.search(A)!=-1){J=0}}}if(J!==0){B.push({score:J,title:d.pages[H].title,desc:z,url:d.pages[H].url});O++}}}else{for(H=0;H<d.pages.length;H++){J=0;z=d.pages[H].text;var A=new RegExp(M,"gi");if(d.pages[H].title.search(A)!=-1){var E=d.pages[H].title.match(A).length;J+=(20*E)}if(d.pages[H].text.search(A)!=-1){var E=d.pages[H].text.match(A).length;J+=(20*E)}if(d.pages[H].tags.search(A)!=-1){var E=d.pages[H].tags.match(A).length;J+=(10*E)}if(d.pages[H].url.search(A)!=-1){J+=20}if(J!==0){for(var L=0;L<d.config.weight.weight.length;L++){console.log(d.pages[H].url);console.log(d.config.weight.weight[L].url);if(d.pages[H].url==d.config.weight.weight[L].url){J+=d.config.weight.weight[L].score}}}if(J!=0){B.push({score:J,title:d.pages[H].title,desc:z,url:d.pages[H].url});O++}}}if(O!=0){if(e.showTitleCount&&h==0){var U=document.title;document.title="("+O+") "+U;h++}if(F){I+='<div class="alert alert-info">'+d.lang[1]+" <em>"+M+"</em>. "+d.lang[2]+' <a id="ss_replaced" class="alert-link">'+p+"</a></div>"}if(O==1){I+='<div class="text-muted text-right">'+d.lang[3]}else{var T=O.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");I+='<div class="text-muted text-right">'+T+" "+d.lang[4]}if(e.showTime){i.end=new Date().getTime();i.diff=(i.end-i.start)/1000;I+=" ("+i.diff.toFixed(2)+" "+d.lang[13]+")";e.showTime=false}I+="</div>";B.sort(function(V,t){return t.score-V.score});I+='<div class="list-group">';var G=0;for(H=0;H<B.length;H++){if(G>=q&&G<e.show+q){I+='<a href="'+B[H].url+'" class="list-group-item"'+j+'><h4 class="list-group-item-heading">'+B[H].title+"</h4>";if(e.debug){I+='<span class="text-danger">'+d.lang[15]+": "+B[H].score+"</span>"}if(e.showURL){var x=B[H].url.toLowerCase();if(x.indexOf("http://")===0){x=x.slice(7)}I+='<div class="text-muted">'+x+"</div>"}if(B[H].desc){var D=B[H].desc;m=M.split(" ");var R=B[H].desc.toLowerCase().indexOf(m[0]);if(R>90){var w=D.substr(R-60);var N=w.indexOf(" ");w=D.substr(R-60+N);w=a.trim(w);if(w.length>60){D="... "+w}}if(P){m=M.split(" ");for(var K=0;K<m.length;K++){if(e.highlightTerms){var v=new RegExp("("+m[K]+")","gi");D=D.replace(v,"<h0011>$1<h0012>")}}}else{if(e.highlightTerms){var v=new RegExp("("+M+")","gi");D=D.replace(v,"<strong>$1</strong>")}}var u="";var S=D.split(" ");if(S.length<e.descriptiveWords){u=D}else{for(K=0;K<e.descriptiveWords;K++){u+=S[K]+" "}}u=a.trim(u);if(u.charAt(u.length-1)!=="."){u+=" ..."}u=u.replace(/h0011/g,"strong");u=u.replace(/h0012/g,"/strong");I+='<p class="list-group-item-text">'+u+"</p></a>"}}G++}I+="</div>";if(e.showRelated&&P){K=0;for(H=0;H<d.config.related.searches.length;H++){if(M===d.config.related.searches[H].search){if(F){r=M}if(!K){I+='<div class="panel panel-default"><div class="panel-heading">'+d.lang[14]+" <strong>"+r+'</strong></div><div class="list-group">'}I+='<a class="ss_related list-group-item" data-related="'+d.config.related.searches[H].related+'">';if(d.config.related.searches[H].before){I+='<span class="label label-default">'+d.config.related.searches[H].before+"</span> "}I+=d.config.related.searches[H].related;if(d.config.related.searches[H].after){I+=' <span class="label label-default">'+d.config.related.searches[H].after+"</span>"}I+="</a>";K++}}if(K){I+="</div></div>"}}if(O>e.show){var l=Math.ceil(O/e.show);var s=(q/e.show);I+='<nav class="text-center"><ul id="ss_pagination" class="pagination">';if(q>0){I+='<li><a accesskey="p" data-start="'+(q-e.show)+'" data-replace="'+Q+'">'+d.lang[5]+"</a></li>"}if(s<=2){var o=0;o=l;if(l>3){o=3}for(K=0;K<o;K++){if(K==s){I+='<li class="active"><span>'+(K+1)+"</span></li>"}else{I+='<li><a data-start="'+(K*e.show)+'" data-replace="'+Q+'">'+(K+1)+"</a></li>"}}}else{var o=0;o=s+2;if(o>l){o=l}for(K=s-1;K<o;K++){if(K==s){I+='<li class="active"><span>'+(K+1)+"</span></li>"}else{I+='<li><a data-start="'+(K*e.show)+'" data-replace="'+Q+'">'+(K+1)+"</a></li>"}}}if(s+1!==l){I+='<li><a accesskey="n" data-start="'+(q+e.show)+'" data-replace="'+Q+'">'+d.lang[6]+"</a></li>"}I+="</ul></nav>"}}else{I+='<div  class="alert alert-danger">'+d.lang[7]+"</div>"}}else{if(C){I+='<div  class="alert alert-danger">'+d.lang[7]+" "+d.lang[8]+"</div>"}else{I+='<div  class="alert alert-danger"><strong>'+d.lang[9]+"</strong><ul>";if(e.minimumLength===1){I+="<li>"+d.lang[10]+"</li>"}else{I+="<li>"+d.lang[11]+" "+e.minimumLength+" "+d.lang[12]+"</li>"}I+="</ul></div>"}}a("#"+e.contentId).html(I);a("#ss_replaced").click(function(){k(0,false)});a(".ss_related").click(function(){a(d.input).val(a(this).data("related"));k(0,true)});a("#ss_pagination").children("li").children("a").click(function(){k(a(this).data("start"),a(this).data("replace"))})}function f(){if(e.debug===true){console.log("SS: Object...");console.log(d)}if(g(a(d.input).attr("name"))){a(d.input).val(g(a(d.input).attr("name")));k(0,true)}a(this).keyup(function(){if(a(d.input).val().length>=e.minimumLength){k(0,true)}})}})}})(jQuery);